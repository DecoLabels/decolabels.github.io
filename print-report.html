<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/jpg" href="./img/logo.ico"/>
	  <link rel="icon" type="image/png" sizes="64x64" href="./img/decologoicon.png">
		<meta name='robots' content='noindex, nofollow'/>
    <title>Print Report | Deco Labels</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
	<link rel="stylesheet" href="./css/deco-styles.css">
	<script src="./js/jquery-3.6.0.min.js"></script>
	<script src="./js/deco-app.js"></script>
	<script type="text/JavaScript" src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.print/1.6.0/jQuery.print.js"></script>
	<script type="text/JavaScript" src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.js"></script>
	<!-- <script src="./js/index.js"></script> -->
  </head>
  <body>
  <section class="section">
    <div class="container">
      <div class="columns is-centered">
	<div class="column is-half p-0">
		<a class="" href="./index.html">
			<img class="logo" src="./img/deco-logo.jpg" alt="Deco Labels"/>
		</a>
	</div>
	</div>		
    </div>
  </section>
   <section class="section py-0 px-3">
		<div class="searchbox pb-4 noprint">
			<div class="category">
				<select class="whatToPrint select is-medium is-fullwidth">
					<option value="">Select what to print</option>
					<option value="production-entry">Production Entry</option>
					<option value="order-picked">Order Picked</option>
					<option value="box-inventory">Box Inventory</option>
				</select>
			</div>

		   <div class="field has-addons">
			  <div class="control search-box order-picked is-fullwidth" style="display:none;">
				<input id="barcode-scanner" class="input mt-5" autofocus type="number" placeholder="Release Ticket" inputmode="numeric" pattern="[0-9]*">
			  </div>
			  <div class="control search-box production-entry" style="display:none;">
				<input id="datePicker" class="input mt-5" autofocus type="date" placeholder="Enter Date">
			  </div>
			  <div class="control search-box box-inventory" style="display:none;">
				<input id="datePickerr" class="input mt-5" autofocus type="date" placeholder="Enter Date">
			  </div>			  
			  <div class="control get-report" style="display:none;">
				<a class="button is-info search-ticket mt-5">Get Report</a>
			  </div>
		   </div>			
		</div>
		<div class="loader-wrapper">
            	     <div class="loader is-loading"></div>
        	</div>
		<!-- list item -->
		<div class="list-to-print">
		<div class="">
			<h1 class="is-size-4 has-text-weight-bold"></h1>
		</div>
		<div class="list" id="listtoprint" style="display:none;"></div>
		</div>
		<!-- list item -->
		<div class="container" >		
			<div class="field has-text-centered mt-6 print-button" style="margin-bottom:8rem;display:none;">
				<button class="button is-primary is-medium">PRINT</button>
			</div>			
		</div>
  </section>
  <nav class="navbar is-fixed-bottom" role="navigation" aria-label="main navigation">
	<div class="navbar-item">    
		<a class="" href="./index.html"><img class="home-icon image is-48x48" src="./img/home-icon.png" alt="HOME"/></a>
	</div>
  </nav>
  
  <script>
 $('.whatToPrint').change(function(){
	var selected =  $('.whatToPrint').val();
	$('.search-box').css('display','none');
	$('.get-report').css('display','none');
	$('.search-box.'+selected).css('display','block');
	$('.get-report').css('display','block');

 });
  $('.search-ticket').click(function(){
		
	var whatToPrint = $('.whatToPrint').val();
	var whichTable = '';
	
	var resultHtml = '';
	$('.loader-wrapper').addClass('is-active');
						
	//get data from google sheet
	var itemstoprint = [];
	whichTable = (whatToPrint == 'order-picked' && whatToPrint != '') ? 'order_picked' : (whatToPrint == 'production-entry'  && whatToPrint != '') ? 'prodn_entry' : 'Box_Inventory';
	var message = (whatToPrint == 'order-picked' && whatToPrint != '') ? 'Please enter Release Ticket Number.' : 'Please enter the date you want to print the report.'
	var resultCount = 0;
	var filtered =[];
	var datePrepared = '';
	var htext = '';
	var whatreport = $('.whatToPrint').val();	
		
	if(whatreport != ''){
	
	$.ajax({
		headers: {'Accept' : 'application/json'},
		type: 'GET',
		url: "https://script.google.com/macros/s/AKfycbyz41PpsyM77NkNhqf6dsah3W5ApSPGIapH-Nrd1EqFNkS4rYYQ98dEwr5WI8Q65vjcGA/exec?action=read&table=" + whichTable,
		beforeSend: function(xhr){xhr.withCredentials = true;},
		success: function (response, textStatus, request){
				
			if(response.success){
				itemstoprint = response.data;	
				itemstoprint.filter(function( item ) {

				switch(whatToPrint) {
  				case 'order-picked':
					var tkt = $('.search-box.' + whatToPrint + ' input').val();
    					if((item.ReleaseTicket) == tkt ){   								
						resultHtml += '<div class="list-item row-'+item.row+'">'+
							         '<div class="list-item-content" id="'+item.ProductNumber+'">'+
							            '<div class="list-item-title"><b>Date: '+new Date(item.Timestamp).toLocaleDateString()+' '+item.ProductNumber+'</b> Ticket#: '+item.TicketNumber+'</div>'+
								     '<div class="list-item-description">'+
								        '<span class="ordrqty">Order QTY: '+item.OrderQty+ '</span>'+
								        '<span class="pqty px-2">Picked QTY: '+item.PickedQty+'</span>'+
								        '<span class="iqty px-2">No. of Boxes: '+(item.NoOfBox + item.NoOfPartBox) +'</span>'+														
								     '</div>'+														
								    '</div>'+													
							       '</div>';
								
						datePrepared = item.Timestamp;
						resultCount++;
					} 
				var d = new Date(datePrepared); d.toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'});
			htext = 'Release Ticket#: '+tkt+ '<span class="is-pulled-right">Date: '+d.toLocaleDateString()+'</span>';
					$('#listtoprint').html('<h1>'+htext+'</h1>' + resultHtml);
    					break;

				case 'production-entry':
					var tkt = $('.search-box.' + whatToPrint + ' input').val();
					var d = "";
					if(tkt.length > 7){
						//d = tkt.toString().substr(0,2) +"/"+tkt.toString().substr(2,2)+"/"+tkt.toString().substr(4,tkt.length);
					}else{
						//d = tkt.toString().substr(0,1) +"/"+tkt.toString().substr(1,2)+"/"+tkt.toString().substr(3,tkt.length);					
					}
					d = tkt.split('-')[1] + '/' + tkt.split('-')[2] + '/' + tkt.split('-')[0];
					var getD = new Date(item.Timestamp);
					var options = {month: '2-digit',day:'2-digit',year:'numeric'};
    					if(getD.toLocaleDateString('en-US',options) == d ){   								
						resultHtml += '<div class="list-item row-'+item.row+'">'+
							         '<div class="list-item-content" id="'+item.Ticket+'">'+
							            '<div class="list-item-title"><b>TICKET#: '+item.Ticket+'</b></div>'+
								     '<div class="list-item-description">'+
									'<span class="ordrqty">'+item.description+ '</span><br>'+
								        '<span class="ordrqty">QTY: '+item.Quantity+ '</span>'+
								        '<span class="iqty px-2">No. of Boxes: '+(item.NoOfBox + item.NoOfPartBox) +'</span>'+														
								     '</div>'+														
								    '</div>'+													
							       '</div>';
								
						//datePrepared = item.Timestamp;
						resultCount++;
					}
					
						htext = '<span class="is-pulled-right">Date: '+ tkt +'</span>';
						$('#listtoprint').html('<h1>'+htext+'</h1>' + resultHtml);

    					break;

				case 'box-inventory':
					// code block
    					break;

  				default:
    					return false;
				}

				}); //end filter

			
			
			//$('.list-to-print h1').html(htext);
			
		      
                       }else{
			   alert('No data available...');
		       }		
		} //success:
	}); //ajax


	setTimeout(function(){
		$('.list-to-print h1').html(htext);
		$('#listtoprint').html(resultHtml);
		$('.loader-wrapper').removeClass('is-active');					
		$('#listtoprint').css('display','block');
		$('.print-button').css('display','block');
		//$('.submit-release-order').css('display','block');
	}, 5000);



	}else{
		
		alert(message);
			
	}
}); //end click
		$('.print-button').click(function(){
		
			$('.list-to-print').print();
			
		});

		/*

			//console.log(resultCount);
			//check results
			if(resultCount == 0){
				whichTable = 'prodn_entry';				
				resultHtml = '';
				$.ajax({
					headers: {'Accept' : 'application/json'},
					type: 'GET',
					url: "https://script.google.com/macros/s/AKfycbyz41PpsyM77NkNhqf6dsah3W5ApSPGIapH-Nrd1EqFNkS4rYYQ98dEwr5WI8Q65vjcGA/exec?action=read&table=" + whichTable,
					beforeSend: function(xhr){xhr.withCredentials = true;},
					success: function (response, textStatus, request){
					
						if(response.success){
							itemstoprint = response.data;	
							itemstoprint.filter(function( item ) {
								if((item.Ticket) == tkt ){
									//filtered.push(item);
									resultHtml += '<div class="list-item row-'+item.row+'">'+
													'<div class="list-item-content" id="'+item.Ticket+'">'+
														'<div class="list-item-title"><b>'+item.Description+'</b></div>'+
														'<div class="list-item-description">'+
														'<span class="ordrqty">Order QTY: '+item.Quantity+ '</span>'+														
														'<span class="iqty px-2">No. of Boxes: '+(item.NoOfBox + item.NoOfPartBox) +'</span>'+														
														'</div>'+														
													'</div>'+													
												 '</div>';
									datePrepared = item.Timestamp;
									resultCount++;
								}
							});
							var d= new Date(datePrepared); d.toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'});
							htext = 'Job Ticket#: '+tkt+ '<span class="is-pulled-right">Date: '+d.toLocaleDateString()+'</span>';
							//$('.list-to-print h1').html(htext);
							//$('#listtoprint').html(resultHtml);
						}else{
							//alert('No data available...');
						}		
					}
				});
			}
			
			*/
			
			
				
			
		
		
	
		
  </script>
  </body>
</html>
