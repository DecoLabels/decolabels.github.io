<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/jpg" href="./img/logo.ico"/>
		<meta name='robots' content='noindex, nofollow'/>
    <title>Pick Order | Deco Labels</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
	<link rel="stylesheet" href="./css/deco-styles.css">
	<script src="./js/jquery-3.6.0.min.js"></script>
	<script src="./js/deco-app.js"></script>
	<script type="text/JavaScript" src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.print/1.6.0/jQuery.print.js"></script>
  </head>
  <body>
  <section class="section">
    <div class="container">
      <div class="columns is-centered">
		  		  <div class="column is-half p-0">
			<a class="" href="./index.html">
			  <img class="logo" src="./img/deco-logo.jpg" alt="Deco Labels"/>
			</a>
		  </div>
		</div>		
    </div>
  </section>
  <section class="section py-0 px-1">
		<div class="searchbox pb-4">
			<div class="field has-addons">
			  <div class="control search-box">
				<input class="input" type="text" placeholder="Release Ticket Number">
			  </div>
			  <div class="control">
				<a class="button is-info search-ticket">Search</a>
			  </div>
			</div>
		</div>
  <div class="container" id="releaseTicket" style="display:none;">
		
		<div class="order-list table-container mb-0">
		<h1 class="is-size-4 has-text-weight-bold"></h1>
			<table  class="table is-bordered is-striped is-narrow is-fullwidth mb-1">
				<thead>
					<tr class="has-text-centered is-size-7-mobile">				  
					  <th>DESCRIPTION</th>
					  <th>ORDERED QTY</th>
					  <th>PICKED QTY</th>
					</tr>				
				</thead>
				<tbody class="release-ticket"></tbody>
			</table> 
		</div>
			<div class="field has-text-right">
				<button id="myBtn" class="button is-white has-text-weight-bold">[ + ]</button>
			</div>
		
		<div class="field has-text-centered mt-6" style="margin-bottom:8rem;">
			<button class="button is-primary is-medium submit-release-order">SUBMIT</button>
		</div>
  </div>
  </section>
  <nav class="navbar is-fixed-bottom" role="navigation" aria-label="main navigation">
	<div class="navbar-item">    
		<a class="" href="./index.html"><img class="home-icon image is-48x48" src="./img/home-icon.png" alt="HOME"/></a>
	</div>
  </nav>
  
  <!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    
		
			<div class="field">
			  <label class="label is-medium mb-0">TICKET:</label>
			  <div class="control">
				<input class="input is-medium ordernumber" type="number" placeholder="">				
			  </div>
			</div>
			<div class="field">
			  <label class="label is-medium mb-0">NO. of BOX(ES):</label>
			  <div class="control">
				<input class="input is-medium" type="number" placeholder="" value="">				
			  </div>
			</div>
			<div class="field">
			  <label class="label is-medium mb-0">NO. of PART BOX:</label>
			  <div class="control">
				<input class="input is-medium" type="number" placeholder="" value="0">				
			  </div>
			</div>
			<div class="field">
			  <label class="label is-medium mb-0">QUANTITY:</label>
			  <div class="control">
				<input class="input is-medium picked_qty" type="number" placeholder="">				
			  </div>
			</div>		
			<div class="field has-text-centered my-6">
				<button class="button is-success is-medium add-item-button">ADD</button>
			</div>
	
  </div>
</div>
<!-- The Modal -->
<script>

	$('.search-ticket').click(function(){
		var ticketnum = $('.search-box input').val();		
		$('.order-list h1').text("TICKET: "+ticketnum);
      //  url: "https://script.google.com/macros/s/AKfycbxSgNM9wfQny5dfqMQdJVriozDoyyw3NHmfgmBM8f6L/dev?action=read&table=order_to_pick&id="+ticketnum,
		$.ajax({
		headers: {'Accept' : 'application/json'},
		type: 'GET',
		url: "https://script.google.com/macros/s/AKfycbyz41PpsyM77NkNhqf6dsah3W5ApSPGIapH-Nrd1EqFNkS4rYYQ98dEwr5WI8Q65vjcGA/exec?action=read&table=order_to_pick&id="+ticketnum,
		beforeSend: function(xhr){
		xhr.withCredentials = true;
		},
		success: function (response, textStatus, request){
		//console.log(response.data);
			var resultHtml = '';
			for(var i=0; i<response.data.length;i++){
				resultHtml += '<tr class="is-size-7-mobile '+response.data[i].product_number+'">'+
								'<td><b>'+response.data[i].product_number+'</b> '+response.data[i].description+'</td>'+
								'<td class="has-text-centered order-qty">'+response.data[i].order_qty+'</td>'+
								'<td class="has-text-centered pick-qty">'+response.data[i].picked_qty+'</td>'+
							  '</tr>';	
			}
			$('.release-ticket').html(resultHtml);
			$('#releaseTicket').css('display','block');
		}
		});
	});
	
	$('.add-item-button').click(function(){
	 var ticketnum = $('.ordernumber').val();	
      
		$.ajax({
		headers: {'Accept' : 'application/json'},
		type: 'GET',
		url: "https://script.google.com/macros/s/AKfycbyz41PpsyM77NkNhqf6dsah3W5ApSPGIapH-Nrd1EqFNkS4rYYQ98dEwr5WI8Q65vjcGA/exec?action=read&table=open_orders&id="+ticketnum,
		beforeSend: function(xhr){
		xhr.withCredentials = true;
		},
		success: function (response, textStatus, request){
		//console.log(response.data);
		var pqty = $('.picked_qty').val();
		var resultHtml = '';
			for(var i=0; i<response.data.length;i++){
				var dpn = (response.data[i].description).substring(0,9);
				var custid = response.data[i].customerid;
				
				if($('.release-ticket tr').hasClass(custid + '' + dpn)){
					var oqty = $('.' + custid + '' + dpn +' .order-qty').text();
					
					if(pqty > oqty){
						if (confirm('The quantity you entered is greater than the ordered quantity. Are you sure to ship the over?')) {
							//send to record...
							$('.' + custid + '' + dpn +' .pick-qty').text(pqty);
							//close the pop up window.
							$('.modal-content .close').click();
						} else {
							// change the quantity
						}			
						
					}else{
						//send to record...
							$('.' + custid + '' + dpn +' .pick-qty').text(pqty);
							//close the pop up window.
							if(pqty < oqty){
								$('.' + custid + '' + dpn +' .pick-qty').addClass('has-text-danger-dark');
							}
							$('.modal-content .close').click();
					
					}
				}else{
					alert("TicketNumber " + $('.ordernumber').val() + " " + dpn +"  is not part of the order!");
					$('.modal-content input').val("");
					
				}
				
			}
			
		}
		});
	});
	
	$('.submit-release-order').click(function(){
		if (confirm('Do you want to print the pick order report?')) {
			//print the order
			$('.order-list').print();
		} else {
			$('.search-box input').val("");
			$('.release-ticket').html("");
			$('.order-list h1').text("");
			$('#releaseTicket').css('display','none');
		}	
	
	});
</script>
  </body>
</html>