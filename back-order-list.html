

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/jpg" href="./img/logo.ico"/>
		<meta name='robots' content='noindex, nofollow'/>
    <title>Inventory Management | Deco Labels</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
	<link rel="stylesheet" href="./css/deco-styles.css">
	<script src="./js/jquery-3.6.0.min.js"></script>
	<script src="./js/deco-app.js"></script>
	<script type="text/JavaScript" src="https://cdnjs.cloudflare.com/ajax/libs/jQuery.print/1.6.0/jQuery.print.js"></script>
  </head>
  <body>
  <section class="section">
    <div class="container">
      <div class="columns is-centered">
	<div class="column is-half p-0">
		<a class="" href="./index.html">
			<img class="logo" src="./img/deco-logo.jpg" alt="Deco Labels"/>
		</a>
	</div>
	</div>		
    </div>
  </section>
   <section class="section py-0 px-3">
		<div class="searchbox pb-4 noprint">
			
		   <div class="field has-addons">
			  
			  <div class="control columns search-box production-entry mx-0">				
				<input placeholder="Enter customer" id="sortby" name="sortbycustomer" list="sortbycustomer" class="select-list column">
				<datalist id="sortbycustomer">					
					<option value="SUMMER FRESH SALADS INC.">
					<option value="FGF BRANDS INC">
					<option value="CANADA BREAD COMPANY LIMITED">
					<option value="SOFINA FOODS INC (BRAMPTON)">
					<option value="CONCORD PREMIUM MEATS LTD">
					<option value="BUNZL CANADA INC BURLINGTON">
					<option value="SOFINA FOODS INC. (BRAMPTON)">
					<option value="2213256 ONTARIO LTD.">
					<option value="IMPERIAL DADE CANADA INC.">
					<option value="VIENNA MEAT - SOFINA FOODS INC.">
					<option value="COMMERCIAL BAKERIES CORPORATION">
					<option value="SANTE MANUFACTURING INC.">
					<option value="SHOPPERS DRUG MART">
					<option value="BIMBO BAKEHOUSE">
					<option value="BATTISTONI ITALIAN SPECIALTY MEATS">
					<option value="FROG BOX (2267605 ONTARIO INC.)">
					<option value="LOBLAW INC">
					<option value="SOFINA FOODS INC (MITCHELL)">
					<option value="TAYLOR FRESH FOODS">
				</datalist>			  
			  <div class="control get-bol">
				<a class="button is-info search-ticket p-5">Get Back Oder List</a>
			  </div>

			  </div>			  
		   </div>			
		</div>
		<div class="loader-wrapper">
            	     <div class="loader is-loading"></div>
        	</div>
		<!-- list item -->
		<div class="back-order-list">
		<div class="">
			<h1 class="is-size-4 has-text-weight-bold"></h1>
		</div>
		<div class="list is-clearfix" id="listtoprint" style="display:none;"></div>
		</div>
		<!-- list item -->
		<div class="container" >		
			<div class="field has-text-centered mt-6 print-button" style="margin-bottom:8rem;display:none;">
				<button class="button is-primary is-medium">PRINT</button>
			</div>			
		</div>
  </section>
  <nav class="navbar is-fixed-bottom" role="navigation" aria-label="main navigation">
	<div class="navbar-item">    
		<a class="" href="./index.html"><img class="home-icon image is-48x48" src="./img/home-icon.png" alt="HOME"/></a>
	</div>
  </nav>

 <!-- The Modal -->
<div id="showAvailableModal" class="modal">
<div class="modal-background" onclick="hideModal('#showAvailableModal')"></div>
 <button class="modal-close is-large" aria-label="close" onclick="hideModal('#showAvailableModal')"></button>  
  	<div class="modal-content">
	<label for="scannedBC" class="has-text-weight-bold">Scan item:</label>
		<input type="text" pattern="([^\s][A-z0-9À-ž\s]+)" id="scannedBC" name="scannedBC" class="input is-medium scannedBC" data-dpn="">
		<input type="hidden" class="releaseTicket">
		<input type="hidden" class="productNumber">
		<input type="hidden" class="orderQty">
		<input type="hidden" class="pickedQty">
		<input type="hidden" class="noOfBox">
		<input type="hidden" class="noOfPartBox">
		<button class="button is-warning mt-4 is-medium doneScanning">DONE</button>
	</div>
</div>
 <!-- The Modal -->
<!-- The Modal -->
<div id="addItemModal" class="modal">
<div class="modal-background" onclick="hideModal('#addItemModal')"></div>
 <button class="modal-close is-large" aria-label="close" onclick="hideModal('#addItemModal')"></button>  
  <div class="modal-content">
	  <div class="field">
		  <label class="label is-medium mb-0 ticket-label">PRODUCT NUMBER:</label>
		  <input class="input is-medium prnumber" type="text" placeholder="Scan or enter product/DPN number" autofocus>
	</div>
  <div class="ordertopick">
	<div class="field">	 
	  <div class="control">
		<label class="label is-medium mb-0 ticket-label">TICKET #:</label>
		<input class="input is-medium ordernumber" type="text" placeholder="">
		<input class="input is-medium dpn" type="hidden">	
		<input class="input is-medium releaseTicket" type="hidden">	
		<input class="input is-medium backOrderQty" type="hidden">	
	  </div>
	</div>
	<div class="field">
	  <label class="label is-medium mb-0">NO. of BOX(ES):</label>
	  <div class="control">
		<input class="input is-medium noOfBox" type="number" placeholder="" value="">				
	  </div>
	</div>
	<div class="field">
	  <label class="label is-medium mb-0">NO. of PART BOX:</label>
	  <div class="control">
		<input class="input is-medium noOfPartBox" type="number" placeholder="" value="0">				
	  </div>
	</div>
	<div class="field">
	  <label class="label is-medium mb-0">QUANTITY:</label>
	  <div class="control">
		<input class="input is-medium picked_qty" type="number" placeholder="">	
		<input class="input is-medium rownumber" type="hidden">	
	  </div>
	</div>		
	<div class="field has-text-centered my-6">
		<button class="button is-success is-medium add-item-button">ADD</button>
	</div>
  </div>
  </div>
</div>
 <!-- The Modal --> 
<script>
var globalDPN = '';
var backOrderList=[];
getBackOrderList();

$('.search-ticket').click(function(){
	
	var customerName = $('#sortby').val();
	var customerID = $('option[value="'+customerName+'"]').data('id');

	var resultHtml = "";
	var count = 0;

	if(customerName != '' || typeof(customerName) == undefined){
		backOrderList.filter(function( item ) {
			//if((item.product_number).substr(0,6) == customerID){
			if(item.customer == customerName && item.BackOrder > 0 && item.shipped > 0){
				resultHtml += '<div class="list-item row-'+item.row+'">'+
				  		 '<div class="list-item-content" id="'+item.id+'">'+
							'<div class="list-item-title" data-id="'+item.product_number+'"><b>'+item.product_number+'</b></div>'+
								 '<div class="columns">'+
									 '<div class="column is-9">'+
										'<span class="dpn">'+item.description+ '</span><br>'+
										'<span class="ordrqty" data-qty="'+item.order_qty+'">Ordered QTY: '+item.order_qty+ '</span>'+
										'<span class="bol px-2">Back Order: '+ item.BackOrder +'</span>'+	
										'<span class="ticketnum px-2">Ticket Number: '+item.id +'</span>'+	
										'<span class="ponum px-2">Shipped: '+item.shipped +'</span>'+
										'<span class="pqty px-2"></span>'+
									 '</div>'+
									 '<div class="column is-3 noprint">'+
										'<button class="button is-dark" onclick="pickProduct(\'' + item.id + '\',\''  + item.product_number + '\',' + item.BackOrder + ',\''+item.row+'\')">Pick Order</button>'+
									 '</div>'+		
								'</div>'+														
							'</div>'+													
						'</div>';
				count++;
			}
		});
if(count > 0){
	$('.back-order-list h1').text(customerName);
	$('.back-order-list .list').html(resultHtml);
	$('.back-order-list .list').css('display','block');
}else{
	$('.back-order-list h1').text("No Back Order Available.");
	$('.back-order-list .list').html("");
}
	}else{
		alert("Please select customer.");	
	}


});

$('.doneScanning').click(function(){
	var releaseTicket = $('#addItemModal .releaseTicket').val();
	var productNumber = $('#addItemModal .productNumber').val();
	var orderQty = $('#addItemModal .orderQty').val();
	var rownumber = $('#addItemModal .rownumber').val();		
	
	var scannedBarcodes = $('.scannedBC').val();
	var qtyscanned = (scannedBarcodes.split(globalDPN)).length - 1;
	$('#addItemModal .prnumber').val(globalDPN);
	$('#addItemModal').css('display','block');
	hideModal('#showAvailableModal');
	$('#addItemModal .noOfBox').val(qtyscanned);
	$('.row'+rownumber).addClass('has-background-success');
	$('.row'+rownumber + ' .ordrqty').addClass('has-text-white');
	$('.row'+rownumber + ' .pqty').addClass('has-text-white');
	$('.row'+rownumber + ' .iqty').addClass('has-text-white');

});

$('#addItemModal .add-item-button').click(function(){
	
	var rown = $('#addItemModal .ordertopick .rownumber').val();
	var ticketnumber = $('#addItemModal .ordertopick .releaseTicket').val();
	var pickedQty = $('#addItemModal .ordertopick .picked_qty').val();
	var noOfBox = $('#addItemModal .ordertopick .noOfBox').val();
	var noOfPartBox = $('#addItemModal .ordertopick .noOfPartBox').val();
	var dpn = $('#addItemModal .prnumber').val();
	var oqty = $('#addItemModal .ordertopick .backOrderQty').val();
	var isOk = false;
	
	if(dpn.indexOf('LOB') <= -1){
	//console.log('.order-list .'+rown+' #'+dpn+' .pqty');
		if(checkQty(parseInt(oqty.replace('Back Order: ','')),pickedQty)){
			$('.back-order-list .row-'+rown+' .pqty').html('Quantity Picked: '+pickedQty);	
			isOk = true;
		}else{
			if (confirm("Are you sure to ship over? Ordered quantity is "+parseInt(oqty.replace('Back Order: ','')))) {
			 $('.row-'+rown+' .pqty').html('Quantity Picked: '+pickedQty);	
			  isOk = true;
			} 
			
		}
		
	}else{
	
		if(checkQty(parseInt(oqty.replace('Order QTY: ','')),noOfBox)){
			$('.row-'+rown+' .pqty').html('Quantity Picked: '+noOfBox);
			isOk = true;
		}else{
			if (confirm("Are you sure to ship over? Ordered quantity is "+parseInt(oqty.replace('Back Order: ','')))) {
			  $('.row-'+rown+' .pqty').html('Quantity Picked: '+noOfBox);	
			  isOk = true;
			} 
		}
		
				
		
	}
		
	
	if(isOk){
		$('.row-'+rown).addClass('has-background-success');
		var releaseTicket = $('.order-list h1').text();
		var datePicked = new Date();
		var data = {
				"Timestamp":datePicked.toLocaleString(),
				"ReleaseTicket":ticketnumber,				
				"ProductNumber":dpn,
				"BackOrder":parseInt(oqty.replace('Back Order: ','')),
				"PickedQty":pickedQty,
				"NoOfBox":noOfBox,
				"NoOfPartBox":noOfPartBox,
				"sheet":"picked_BackOrder"
			};
					
		$.ajax({
		headers: {'Accept' : 'application/json'},
		type: 'GET',
		url: 'https://script.google.com/macros/s/AKfycbyLXRqGjBgdGr-XRoWsxYc8-IKyLl7wcaSmMnC5q32HtE8mzxfZ9nnRjYZx-wbRQ5pK/exec',
		data: data,
		beforeSend: function(xhr){
		xhr.withCredentials = true;
		},
		success: function (response){
		
			if(response.success){
				//console.log(response);
				$('.row-'+rown).addClass('has-background-success');
				
			}else{
			    alert('Something went wrong... Please add item again.');
			}		
		}
		});
		
	
		
		hideModal('#addItemModal');
	}
	
	
	 
	});

	function checkQty(ordered, picked){
		if(picked > ordered){
			return false;
		}else{
			return true;
		}
	}

	function getBackOrderList(){
		$.ajax({
			headers: {'Accept' : 'application/json'},
			type: 'GET',
			url: "https://script.google.com/macros/s/AKfycbyz41PpsyM77NkNhqf6dsah3W5ApSPGIapH-Nrd1EqFNkS4rYYQ98dEwr5WI8Q65vjcGA/exec?action=read&table=order_to_pick",
			beforeSend: function(xhr){
			xhr.withCredentials = true;
			},
			success: function (response, textStatus, request){
				var filteredList = response.data;				
				backOrderList = filteredList.sort(function(a, b){return (b.product_number < a.product_number) ? 1 : -1;}).sort(function(a, b){return (b.id < a.id) ? 1 : -1;});
			
			}
		});
			
	}

	function pickProduct(tktnum, dpn, qty, rownum){	
		$('#addItemModal .releaseTicket').val(tktnum);
		$('#addItemModal .productNumber').val(dpn);
		$('#addItemModal .backOrderQty').val(qty);
		$('#addItemModal .rownumber').val(rownum);		
		
		globalDPN = dpn.substr(0,15);
		
		$('.scannedBC').val('');
		
		$('#showAvailableModal').css('display','block');
		
		
	}


	

</script>
  </body>
</html>
